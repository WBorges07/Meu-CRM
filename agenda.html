<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Elite - CRM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <style>
        :root { 
            --bg-dark: #020617; 
            --card-dark: #0f172a; 
            --accent-blue: #38bdf8; 
            --border-color: #1e293b; 
        }
        body { background-color: var(--bg-dark); color: #f1f5f9; font-family: 'Inter', sans-serif; padding: 40px; }
        
        .header-agenda { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .btn-modern-back {
            background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); color: #fff; padding: 12px 24px;
            border-radius: 12px; font-weight: 700; text-decoration: none; transition: 0.3s;
        }
        .btn-modern-back:hover { border-color: var(--accent-blue); color: var(--accent-blue); transform: translateY(-2px); }

        #calendar-container { 
            background: var(--card-dark); 
            border: 1px solid var(--border-color); 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Estiliza√ß√£o do Calend√°rio (Dark Mode) */
        .fc { color: #f1f5f9; border-color: var(--border-color); }
        .fc-theme-standard td, .fc-theme-standard th { border: 1px solid var(--border-color) !important; }
        .fc-toolbar-title { color: var(--accent-blue) !important; font-weight: 800; text-transform: uppercase; }
        .fc-button-primary { background: #1e293b !important; border: 1px solid var(--border-color) !important; color: #94a3b8 !important; font-weight: bold; }
        .fc-button-primary:hover { background: var(--accent-blue) !important; color: #020617 !important; }
        .fc-button-active { background: var(--accent-blue) !important; color: #020617 !important; border: none !important; }
        
        .fc-daygrid-day-number { color: #94a3b8; text-decoration: none; padding: 10px; font-weight: 700; }
        
        /* Eventos clic√°veis */
        .fc-event { 
            cursor: pointer; 
            border: none !important; 
            padding: 5px 10px; 
            border-radius: 8px; 
            font-weight: 600; 
            font-size: 0.85rem; 
            transition: all 0.2s ease;
        }
        .fc-event:hover { 
            filter: brightness(1.2); 
            transform: scale(1.03); 
            box-shadow: 0 5px 15px rgba(56, 189, 248, 0.3);
        }
    </style>
</head>
<body>

<div class="container-fluid px-5">
    <div class="header-agenda">
        <h2 class="fw-bold mb-0">üìÖ Agenda de <span style="color: var(--accent-blue)">Prazos e Audi√™ncias</span></h2>
        <a href="index.html" class="btn-modern-back">‚Üê Voltar ao In√≠cio</a>
    </div>

    <div id="calendar-container">
        <div id="calendar"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script type="module">
    import { db } from './firebase.js';
    import { collection, onSnapshot, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'pt-br',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek'
            },
            buttonText: {
                today: 'Hoje',
                month: 'M√™s',
                week: 'Semana'
            },
            // Define o que acontece ao clicar no evento
            eventClick: function(info) {
                // Impede o comportamento padr√£o do navegador caso haja um link direto no objeto
                info.jsEvent.preventDefault();
                
                if (info.event.url) {
                    window.location.href = info.event.url;
                }
            },
            events: []
        });
        
        calendar.render();

        // Escuta os clientes e seus prazos em tempo real
        onSnapshot(query(collection(db, "clientes")), (snapshot) => {
            const eventos = [];
            
            snapshot.forEach(docSnap => {
                const c = docSnap.data();
                const id = docSnap.id;

                // Verifica se o cliente tem um prazo definido
                if (c.proximoPrazo) {
                    eventos.push({
                        id: id,
                        title: `‚öñÔ∏è ${c.nome}`,
                        start: c.proximoPrazo,
                        // URL din√¢mica enviando o ID para a mesma tela de detalhes
                        url: `detalhes.html?id=${id}`,
                        backgroundColor: c.situacao === 'Causa ganha' ? '#10b981' : 
                                         c.situacao === 'Em negocia√ß√£o' ? '#fbbf24' : '#38bdf8',
                        textColor: '#020617'
                    });
                }
            });

            // Atualiza o calend√°rio sem recarregar a p√°gina
            calendar.removeAllEvents();
            calendar.addEventSource(eventos);
        });
    });
</script>
</body>
</html>